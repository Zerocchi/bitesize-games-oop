pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
--main

gravity=1
level=1
points=0

function _init()	
	for i=1,level do
		add(fruits,fruit:new(i))
	end
end

function _update()
	plr:update()
	
	for f in all(fruits) do
		f:update()
		
		if f:collided(plr) do
			points+=1
			del(fruits,f)
		end
		
		if f:offscreen() do
			del(fruits,f)
		end
		
		if #fruits==0 then
			level+=1
			_init()
		end
		
	end
end

function _draw()
	cls()
	
	rectfill(0,108,127,127,3)
	plr:draw()
	basket:draw()
	
	for f in all(fruits) do
		f:draw()
	end
	
	print("score: "..points)
end
-->8
--base class

class=setmetatable({
	new=function(self,tbl)
		tbl=tbl or {}
		setmetatable(tbl,{
			__index=self
		})
		return tbl	
	end
},{__index=_ENV})

entity=class:new({
		x=0, 
		y=0,
		sp=0
})
-->8
--player
plr=entity:new({
	x=64,
	y=100,
	sp=2,
	
	update=function(_ENV)
		if btn(⬅️) then x-=2 end
		if btn(➡️) then x+=2 end
	end,
	
	draw=function(_ENV)
		spr(sp,x,y)
	end
})

basket=entity:new({
	x=0,
	y=0,
	sp=1,

	draw=function(_ENV)
		spr(sp,plr.x,plr.y-8)
	end
})
-->8
--fruits
fruits={}

fruit=entity:new({
	start=16,
	cnt=6,
	itvl=16,
	x=0,
	y=0,
	
	new=function(_ENV,i)
		local tbl={}
		tbl.x=flr(rnd(120)+5)
		tbl.y=i*(-itvl)
		tbl.sp=flr(rnd(cnt)+start)
		setmetatable(tbl,{__index=_ENV})
		return tbl
	end,
	
	update=function(_ENV)
		y+=gravity
	end,
	
	draw=function(_ENV)
		spr(sp,x,y)
	end,
	
	collided=function(_ENV,plr)
		if  y+4>=plr.y-8
		and y+4<=plr.y
		and x+4>=plr.x
		and x+4<=plr.x+8 then
			return true
		else
			return false
		end
	end,
	
	offscreen=function(_ENV)
		return y>100
	end
	
})
__gfx__
0000000006666660f044440f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000070000006f0ffff0f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070067777775f0ffff0f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700066060605888ff88800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000606060d50088880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070066060d0500c00c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000060d0d05500c00c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000055555500dd00dd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000043b00000900000b0b0b00000b300000000b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000bb03b0000a800000bbb00000b3300000008730099840000000000000000000000000000000000000000000000000000000000000000000000000000000000
00b7b0000000a8000079a900088338800000807b0998488000000000000000000000000000000000000000000000000000000000000000000000000000000000
00b7bb000000a800079a9a40886888880008887b97a9998800000000000000000000000000000000000000000000000000000000000000000000000000000000
0b7bbb30000a900009a9a490867688850080807b9a99998800000000000000000000000000000000000000000000000000000000000000000000000000000000
0bbbbb3000a980000a9a494088688885088887b39999998800000000000000000000000000000000000000000000000000000000000000000000000000000000
03bbbb30aaa8000009a4949008888850b7777b300999988000000000000000000000000000000000000000000000000000000000000000000000000000000000
0033330099800000004949000555550003bbb3000088880000000000000000000000000000000000000000000000000000000000000000000000000000000000
